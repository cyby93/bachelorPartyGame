<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>RAID NIGHT - Controller</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div id="controller-container">
    <div id="connection-screen">
      <h1>ğŸ® RAID NIGHT</h1>
      <input type="text" id="player-name" placeholder="Enter your name" maxlength="15">
      <select id="class-select">
        <option value="Warrior">âš”ï¸ Warrior (Tank)</option>
        <option value="Paladin">ğŸ”¨ Paladin (Tank/Heal)</option>
        <option value="Shaman">âš¡ Shaman (DPS/Heal)</option>
        <option value="Hunter">ğŸ¹ Hunter (DPS)</option>
        <option value="Priest">âœï¸ Priest (Healer)</option>
        <option value="Mage">ğŸ”¥ Mage (DPS)</option>
        <option value="Druid">ğŸŒ¿ Druid (Hybrid)</option>
        <option value="Rogue">ğŸ—¡ï¸ Rogue (DPS)</option>
      </select>
      <button id="join-button">JOIN GAME</button>
    </div>
    <div id="waiting-screen">
      <h2>â³ Waiting for game to start...</h2>
      <p>Get ready to fight Illidan!</p>
    </div>
    <div id="player-info">
      <span class="player-name" id="info-name"></span>
      <span class="player-hp" id="info-hp">HP: 100/100</span>
    </div>
    <div id="game-screen">
      <div id="move-zone"></div>
      <div id="skill-grid">
        <div class="skill-cell skill-0">
          <span class="skill-name" id="skill-name-0">Skill 1</span>
          <span class="skill-icon" id="skill-icon-0">âš”ï¸</span>
          <div class="cooldown-overlay"></div>
        </div>
        <div class="skill-cell skill-1">
          <span class="skill-name" id="skill-name-1">Skill 2</span>
          <span class="skill-icon" id="skill-icon-1">ğŸ›¡ï¸</span>
          <div class="cooldown-overlay"></div>
        </div>
        <div class="skill-cell skill-2">
          <span class="skill-name" id="skill-name-2">Skill 3</span>
          <span class="skill-icon" id="skill-icon-2">ğŸ’¨</span>
          <div class="cooldown-overlay"></div>
        </div>
        <div class="skill-cell skill-3">
          <span class="skill-name" id="skill-name-3">Skill 4</span>
          <span class="skill-icon" id="skill-icon-3">ğŸŒ€</span>
          <div class="cooldown-overlay"></div>
        </div>
      </div>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
  <script type="module" src="/js/config/SkillDatabase.js"></script>
  <script type="module">
    import InputManager from './js/managers/InputManager.js';
    import { CLASSES, CLASS_NAMES } from './js/Constants.js';
    const socket = io();
    let inputManager = null;
    let playerData = null;
    const connectionScreen = document.getElementById('connection-screen');
    const waitingScreen = document.getElementById('waiting-screen');
    const gameScreen = document.getElementById('game-screen');
    const playerInfo = document.getElementById('player-info');
    const joinButton = document.getElementById('join-button');
    const playerNameInput = document.getElementById('player-name');
    const classSelect = document.getElementById('class-select');
    joinButton.addEventListener('click', () => {
      const name = playerNameInput.value.trim() || 'Player';
      const className = CLASS_NAMES[classSelect.value];
      socket.emit('join_game', {
        name: name,
        className: className,
        isHost: false
      });
      playerData = {
        name: name,
        className: className
      };
      connectionScreen.style.display = 'none';
      gameScreen.style.display = 'flex';
      playerInfo.classList.add('visible');
      const classData = CLASSES[className];
      document.getElementById('info-name').textContent = name;
      document.getElementById('info-hp').textContent = `HP: ${classData.hp}/${classData.hp}`;
      classData.skills.forEach((skill, index) => {
        document.getElementById(`skill-name-${index}`).textContent = skill.name;
        document.getElementById(`skill-icon-${index}`).textContent = skill.icon;
      });
      inputManager = new InputManager(socket);
      inputManager.initMoveJoystick('move-zone');
      inputManager.initSkillGrid();
    });
    socket.on('game_started', (state) => {
      console.log('Boss fight starting!');
    });
    socket.on('game_state', (state) => {
      if (state.players && state.players[socket.id]) {
        const player = state.players[socket.id];
        const classData = CLASSES[playerData.className];
        document.getElementById('info-hp').textContent = `HP: ${Math.ceil(player.hp)}/${classData.hp}`;
      }
    });
    socket.on('skill_cooldown', (data) => {
      // Only update cooldown if this is for our player
      if (data.playerId === socket.id && inputManager) {
        inputManager.updateCooldown(data.skillIndex, data.cooldownEnd);
      }
    });
    document.addEventListener('touchmove', (e) => {
      e.preventDefault();
    }, { passive: false });
  </script>
</body>
</html>
